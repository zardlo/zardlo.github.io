<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="pue">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../css/pue.css" rel="stylesheet" />
<link href="../css/style.css" rel="stylesheet" />
<script src="../js/jquery.js" type="text/javascript"></script>
<script src="../js/highcharts.js"></script>
<script type="text/javascript" src="../js/WdatePicker.js"></script>
<link href="../css/WdatePicker.css" rel="stylesheet" type="text/css">
<title>无标题文档</title>
</head>
<script>
if($(window).outerWidth(true)>1800){
	document.write('<link href="css1/Screen2.css" rel="stylesheet" type="text/css" />')
}
</script>
<body >
<div class="warll" style="position:static"> 
    
  <div class="printop">
  	<table style="width:100%">
    	<tr><td align="left"><a class="ls_btn" href="puetp_print.html">确认打印</a><a id="set" class="ls_btn" style="margin-left:14px;">设置</a></td></tr>
    </table>
  </div>
  
  
  <div class="zhset psetting">
      <h3><i class="icon_back" id="icon_back2"><img src="../images/iconfont_circle_close.png" /></i>手动设置</h3>
      <div>
      	<div class="zh_setl">
        	<table class="ntitab">
        		<tr><td align="left" class="ittd"><input type="checkbox" class="" /><a class="it">IT电能：</a></td><td align="left"><select style="width:75px;" class="sbsel"><option>精密配电</option><option>普通配电</option><option>精密空调</option></select></td></tr>
                <tr><td align="left" class="noittd"><input type="checkbox" class="" /><a class="noit">空调电脑：</a></td><td align="left"><select  style="width:75px;" class="sbsel"><option>照明</option></select></td></tr>
                <tr><td align="left" class="noittd"><input type="checkbox" class="" /><a class="noit">其他：</a></td><td align="left"><select  style="width:75px;" class="sbsel"><option>精密配电</option><option>普通配电</option></select></td></tr>
       		</table>
        </div>
        <div class="zh_setr">
        	<h4>精密配电</h4>
            <div class="con fixed">
            	<div class="boxleft">
                	<table class="lechtab chtab">
                            <tr><td><input type="checkbox" />A相电压</td></tr>
                            <tr><td><input type="checkbox" />B相电压</td></tr>
                            <tr><td><input type="checkbox" />C相电压</td></tr>
                            <tr><td><input type="checkbox" />A相电流</td></tr>
                            <tr><td><input type="checkbox" />B相电流</td></tr>
                            <tr><td><input type="checkbox" />C相电流</td></tr>
                            <tr><td><input type="checkbox" />A相有功功率</td></tr>
                            <tr><td><input type="checkbox" />B相有功功率</td></tr>
                            <tr><td><input type="checkbox" />C相有功功率</td></tr>
                    </table>
                </div>
                <div class="boxcen"><a class="setadd" style="margin-top:40px;">添加 》</a><a class="setdele">《 删除</a></div>
                <div class="boxright">
                <table class="richtab chtab">
                </table>
                </div>
            </div>
            
        </div>
      </div>
    </div>
  
  <!--瞬时开始-->
  <div class="pue_top">
  	<div class="puezz" >
      <h3>PUE瞬时统计</h3>
      <div class="ssnum">最大值：12:00:00<span class="max">5kw</span>最小值：17:00:00<span class="min">0.2Kw</span>平均值：<span class="average">3Kw</span></div>
    </div>
    <div class="container" id="container" style="height:300px;" ></div>
    <!--PUE瞬时值图表--> 
    <span class="pue_set" id="pue_set1">设置</span>
    <div class="psetting">
      <h3><i class="icon_back" id="icon_back1"><img src="../images/iconfont_circle_right.png" /></i>手动设置</h3>
      <table>
        <tr>
          <td>总功率：</td>
          <td><input type="text" class="text" /></td>
        </tr>
        <tr>
          <td> IT功率：</td>
          <td><input type="text" class="text" /></td>
        </tr>
        <tr>
          <td colspan="2"><input type="button" class="pue_btn" value="确定" /></td>
        </tr>
      </table>
    </div>
  </div>
  <!--瞬时结束-->
  
  <!--综合能耗对比开始-->
  <div class="pue_bottom">
    <div class="puezz" >
      <h3>综合能耗对比</h3>
    </div>
    <div style="height:85%">
    <div class="tabl">
      <table style="width:80%">
        <tr>
          <td align="right">选择设备：</td>
          <td align="left"><select class="puesel">
              <option>1</option>
              <option>2</option>
            </select></td>
          <td align="right">数据类型：</td>
          <td align="left"><select class="puesel">
              <option>1</option>
              <option>2</option>
            </select></td>
          <td align="right">日期类型：</td>
          <td align="left"><select class="puesel">
              <option>年</option>
              <option>月</option>
            </select></td>
          <td align="right">时间选择：</td>
          <td align="left"><input type="date" value="2016-03-03"  style="width:120px" /></td>
          
          <td style="vertical-align:middle; text-align:left"><a href="javascript:void(0);" onclick="btn_form()" class="ls_btn">筛选</a></td>
        </tr>
      </table>
      </div>
      <div class="container" id="container2" style="height:400px;" ></div>
    </div>
    
  
    
  </div>
  <!--综合能耗对比结束-->
  
  <!--总能耗趋势开始-->
  <div class="pue_bottom">
    <div class="puezz" >
      <h3>总能耗趋势</h3>
    </div>
    <div class="">
    	<div class="tabl">
      <table style="width:80%">
        <tbody><tr>
          <td align="right">选择设备：</td>
          <td align="left"><select class="puesel">
              <option>1</option>
              <option>2</option>
            </select></td>
          <td align="right">日期类型：</td>
          <td align="left"><select class="puesel">
              <option>年</option>
              <option>月</option>
            </select></td>
          <td align="right">时间选择：</td>
          <td align="left"><input type="date" style="width:120px" value="2016-03-03" ></td>
          
          <td style="vertical-align:middle; text-align:left"><a class="ls_btn" onclick="btn_form()" href="javascript:void(0);">筛选</a></td>
        </tr>
      </tbody></table>
      </div>
      <div class="container" id="container3" style="height:320px;"></div>
    </div>
  </div>
  <!--总能耗趋势结束-->
  
</div>
</body>
<script type="text/javascript">
$(function () {
	$("#set").click(function(){
		$(".zhset").show()
	})
	//下拉
	$(".dnbtn").click(function(){
		$(".dropdown-menu").hide();
		$(this).next(".dropdown-menu").show();
		})
	$(".dropdown-menu li").click(function(){
		$(this).parent().prev(".dnbtn").children("span").text($(this).text());
		$(this).parent().hide();
		})
	//下拉结束
	//设置
	/*$("#pue_set1").click(function(){
		$(this).next(".psetting").animate({"right":0},300);
		if($(window).outerWidth(true)>1800){
			$(".mytext").animate({"right":+$(this).css("right").replace("px","")+320},300)
		}else
		$(".mytext").animate({"right":+$(this).css("right").replace("px","")+200},300)
	})*/
	/*$("#pue_set2").click(function(){
		$(this).next(".psetting").animate({"right":0},300);
	})*/
	/*$("#icon_back1").click(function(){
		if($(window).outerWidth(true)>1800){
			$(this).parent().parent(".psetting").animate({"right":"-282px"},300)
		    $(this).parent().parent().next(".mytext").animate({"right":80},300)
		}else{
		$(this).parent().parent(".psetting").animate({"right":"-182px"},300)
		$(this).parent().parent().next(".mytext").animate({"right":50},300)}
	})
	*/
	$("#icon_back2").click(function(){
		/*if($(window).outerWidth(true)>1800){
			$(this).parent().parent(".psetting").animate({"right":"-652px"},500)
		}else{
		$(this).parent().parent(".psetting").animate({"right":"-552px"},500)
		}*/
		$(".zhset").fadeOut();
	})
	/*$(".cancel").click(function(){
		if($(window).outerWidth(true)>1800){
			$(this).parents(".zhset").animate({"right":"-652px"},500)
		}else{
		$(this).parents(".zhset").animate({"right":"-552px"},500)
		}
		$(".ntitab>tbody>tr>td input:checkbox").removeAttr("checked"); 
	})*/
	//设置结束
	$(".warll_close").click(function(){
		$("#pueIf",window.parent.document).remove();	
	})
	
	//综合PUE的设置
	/*$(".zh_setl .it,.ittd").click(function(){
		$(".zh_setr").children(".con").eq(0).show()
		$(".zh_setr").children(".con").eq(1).hide()
	})
	$(".zh_setl .noit,.noittd").click(function(){
		$(".zh_setr").children(".con").eq(0).hide()
		$(".zh_setr").children(".con").eq(1).show()
	})*/
	
	$(".sbsel").change(function(){
		var val=$(this).val()
		$(".zh_setr>h4").text(val)
	})
	$(".chtab td input:checkbox,.zh_setl table td input:checkbox").removeAttr("checked"); 
	$(".setadd").click(function(){  //添加
		//e.stopPropagation();
		//console.log($("#lechtab>tbody>tr>td input:checked").parents("tbody").html())
		$(".lechtab>tbody>tr>td input:checked").parents("tr").appendTo($(this).parent(".boxcen").siblings(".boxright").children(".richtab"))
		$(".richtab td input:checkbox").removeAttr("checked");
	})
	$(".setdele").click(function(){  //删除
		//console.log($("#lechtab>tbody>tr>td input:checked").parents("tbody").html())
		$(".richtab>tbody>tr>td input:checked").parents("tr").appendTo($(this).parent(".boxcen").siblings(".boxleft").children(".lechtab"))
		$(".lechtab td input:checkbox").removeAttr("checked");
	})
})

 $(document).ready(function() {
	 
	 //根据屏幕调整图表字体
	 if($(window).outerWidth(true)>1800){
        Highcharts.setOptions({
			chart: {
				style:{fontSize:'25px'}
			},
			 tooltip: {
				style: {
					fontSize:'25px'
					}},	
			 title: {
				style:{  //设置样式	 
 					  fontSize: '35px'		 	
					},
				align:"left"
            },
			credits:{
    			 enabled:false // 禁用版权信息
			},
            global: {
                useUTC: false
            }
        });}else{
			Highcharts.setOptions({
			chart: {
				style:{fontSize:'18px'}
			},
			 tooltip: {
				style: {
					fontSize:'10px'
					}},	
			 title: {
				style:{  //设置样式	 
 					  fontSize: '25px'		 	
					},
				align:"left"
            },
			credits:{
    			 enabled:false // 禁用版权信息
			},
            global: {
                useUTC: false
            }
        });
	}
	//根据屏幕调整图表字体结束
	//第一个大图表
   
		var test=[1,2,3,4,5,6]; //测试数据
        $('#container').highcharts({
            chart: {
                type: 'spline',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                events: {
					addSeries:function(){alert("ff")},
                    load: function() {
                        // set up the updating of the chart each second
                       			
								 var series = this.series[0];
								
								 var series2 = this.series[1];
								  var series3 = this.series[2];
								setInterval(function() { var mt=test[Math.floor(Math.random()*5)];
								var mdat=[];
									var x = (new Date()).getTime(); // current time
										mdat.push(x)
									console.log(mdat);
										y = mt;
									series.addPoint([x, y], true, true);
									series2.addPoint([x,Math.floor(Math.random()*5)], true, true);
									series3.addPoint([x,Math.floor(Math.random()*8)], true, true);
								}, 3000);
								var inner="";
							 for(var i=0; i<this.series.length;i++){
					 inner+='<li style="background:'+this.series[i].color+'"><span class="mname">'+this.series[i].name+'</span><br /><span>'+Highcharts.numberFormat(this.series[i].data[30].y,3)+'</span></li>';
							 }
							 $(".pue_top").append('<ul class="mytext">'+inner+'</ul>');
                   		 },
			 redraw: function () {//图表重绘更新触发的事件
				 for(var i=0; i<this.series.length;i++){
				 if(typeof this.series[i].data[30]!="undefined"){	
						 $(".mytext li:eq("+i+") span").not(".mname").text(Highcharts.numberFormat(this.series[i].data[30].y,3));
						 }else{
						$(".mytext  li:eq("+i+")").hide();
						}
					 }
				  }
               }
            },
			  
            title: {
                text: '',
				style:{  //设置样式
					  color: '#000',
					  fontFamily:"微软雅黑"	
					},
				align:"left"
            },
            xAxis: {
				
                type: 'datetime',
				
               // tickPixelInterval: 150
            },
            yAxis: {
                title: {
                    text: '瞬时值'
                },
                
            },
            tooltip: {

                formatter: function() {
                        return '<b>'+ this.series.name +'</b><br/>'+
                        Highcharts.numberFormat(this.y, 2)+"  "+ Highcharts.dateFormat('%H:%M:%S', this.x) +'<br/>';    
                }
            },
            exporting: { //禁用导入报表
                enabled: false
            },	
			 legend: {  //图例
                layout: 'horizontal',  //horizontal  布局 水平或者垂直
                align: 'center',   //水平位置
                verticalAlign: 'top' //垂直位置
              	//  borderWidth: 1,
				//floating:"true",
				//x:200	
            },
			 plotOptions: {
				 series: {
					events: {
					//控制图标的图例legend  
					legendItemClick: function (event) { //点击图例隐藏显示曲线右侧数值相应变化      
					              var _this=this;
								$(".mytext li").each(function(index, element) {
                                    if($(this).children(".mname").text()==_this.name){
										$(this).toggle();
										}
                                });	
						}				
					   }		
					},
                   spline: {
                           marker:{
                                enabled: false,  //不显示曲线上的点
                                states: {
                                     hover: { //鼠标移上去显示
                                         enabled: true,
                                         symbol: 'circle',
                                         radius: 5,
                                         lineWidth: 1
                                     }
                                 }
                              }
                         }
                   },
            series: [{  //初始化图表的数据
                name: 'PUE值',
                data: (function() {
                    // generate an array of random data
                    var data = [],
                        time = (new Date()).getTime(),
                        i;
						var k=1;
                    for (i = -30; i <= 0; i++) {
						
                        data.push({
                            x: time + i * 1000,
                            y: test[Math.floor(-i%5)]
                        });
                    }
                    return data;
                })()
            },{
                name: 'PUE值2',
                data: (function() {
                    // generate an array of random data
                    var data = [],
                        time = (new Date()).getTime(),
                        i;
						var k=1;
                    for (i = -30; i <= 0; i++) {
						
                        data.push({
                            x: time + i * 1000,
                            y: Math.floor(Math.random()*5)
                        });
                    }
                    return data; 
                })()
            },{
                name: 'PUE值3',
                data: (function() {
                    // generate an array of random data
                    var data = [],
                        time = (new Date()).getTime(),
                        i;
						var k=1;
                    for (i = -30; i <= 0; i++) {
						
                        data.push({
                            x: time + i * 1000,
                            y: Math.floor(Math.random()*5)
                        });
                    }
                    return data;
					
                })()
            }]//初始化图表的数据结束
        });
	//第一个大图表结束 */
		
	//PUE综合
//function fun(mdata){

	var last=[33, 22, 11, 44, 55, 70, 30, 40, 22, 28, 29, 40]
	var nowd=[43, 32, 14, 54, 78, 80, 40, 45, 33, 40, 33, 45]
	var time=['1月', '2月', '3月', '4月', '5月','6月', '7月', '8月', '9月', '10月','11月', '12月']
    $('#container2').highcharts({                                          
		chart: {type: 'column',
		 backgroundColor:'none',
		 },

        title: {
           text: false
        },
       colors:['#1fb529','#7cb5ec'],
       xAxis: {
            gridLineWidth: 0,//网线
            categories:time,
			
        },
		
        yAxis: {
            title: {
                   text:'能耗'
                },//Y轴标题
        },
		 tooltip: {
        	   // pointFormat: '{series.name}: <b>{point.y:.1f}kw/h</b>'
			      style: {
                		fontSize: '12px',
            	  }, 
			 	  formatter:function(){
					  var s;
					  var add=[(nowd[this["point"]["x"]]-last[this["point"]["x"]])/last[this["point"]["x"]]]*100
					    
					   s = ''+                                               
                       '2015年' + time[this["point"]["x"]]+':'+ last[this["point"]["x"]]+'kw' +'<br>' + '2016年' +time[this["point"]["x"]] +':'+ nowd[this["point"]["x"]]+'kw' + '<br>' +'同比增加:' +add.toFixed(2) +'%'; 
					 
					  return s; 
				  }
            },
        plotOptions: {
            line: {
                dataLabels: {
                    enabled: true
                },
                enableMouseTracking: false
            }
        },
		credits: {
                enabled: false
            },
			
		
		exporting: {
			    enabled:false
			},
        series: [
		{                                                        
            type: 'column',                                               
            name: '2015',                                                 
            data: last                                     
        }, {                                                              
            type: 'column',                                               
            name: '2016',                                                 
            data: nowd                                        
        }]
    });            
        
//}

$("#year .dropdown-menu li").click();
/*$("#mouth .dropdown-menu li").click(function(){
	var mdata={ categories: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],series:[{
                name: '1',
                data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6,7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6,7.0, 6.9, 9.5, 14.5, 18.2, 21.5]
            }]
		}
	fun(mdata);
	})*/
 
    var it=[3, 2, 1, 3, 4,5,9,11,5,7,12,17]
	var kt=[2, 3, 5, 7, 6, 10, 11, 15, 8, 4, 12, 12, ]
	var oth=[4, 3, 3, 9, 2, 4, 8, 1, 5, 4, 7,4]
	var sun=[]
	for(var i=0;i<it.length;i++){
		sun.push(it[i]+kt[i]+oth[i])
	}                                                    
    $('#container3').highcharts({                                          
        chart: {                                                          
        },                                                                
        title: {                                                          
            text:null                                     
        },   
		colors:['#7cb5ec','#434348','#90ed7d','#f7a35c'],                                                             
        xAxis: {                                                          
            categories: ['1月', '2月', '3月', '4月', '5月','6月', '7月', '8月', '9月', '10月','11月', '12月']
        },
		yAxis: {
            title: {
                    text:'能耗'
                },//Y轴标题
        },                                                                
        tooltip: {
			style: {
                fontSize: '12px',
            },                                                        
            formatter: function() {                                       
                var s;     
				var itpct=(it[this["point"]["x"]]/sun[this["point"]["x"]])*100
				var ktpct=(kt[this["point"]["x"]]/sun[this["point"]["x"]])*100
				var othpct=(oth[this["point"]["x"]]/sun[this["point"]["x"]])*100
				//console.log(sun[this["point"]["x"]-1])                                                  
                    s = ''+                                               
                       'IT电能' +'：'+ it[this["point"]["x"]] +'kw　' +itpct.toFixed(2) +'%' +'<br>'+ '空调' +'：'+ kt[this["point"]["x"]] +'kw　' +ktpct.toFixed(2) +'%' +'<br>'+ '其他' +':' +  oth[this["point"]["x"]] +'kw　'+othpct.toFixed(2) +'%' +'<br>' + '总电量' +':' + sun[this["point"]["x"]] +'kw';                            
                                                                     
                return s; 
				                                             
            }      
			// pointFormat: '{series.name}: <b>{point.y:.1f}</b>'                                                       
        },                                                                
                                                           
        series: [ {                                                              
            type: 'spline',                                               
            name: '总电量',                                              
            data: sun,                            
                                                                    
        },{                                                        
            type: 'column',                                               
            name: 'IT电能',                                                 
            data: it                                      
        }, {                                                              
            type: 'column',                                               
            name: '空调',                                                 
            data: kt                                         
        }, {                                                              
            type: 'column',                                               
            name: '其他',                                                  
            data: oth                                       
        }]                                                                
    });  
 });
	
		</script>
</html>
